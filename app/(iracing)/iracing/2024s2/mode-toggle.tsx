'use client';

import { useTheme } from 'next-themes';
import { useCallback, useEffect, useState } from 'react';

export default function ModeToggle() {
    const { theme, setTheme } = useTheme();
    const DEFAULT_ROTATION = 90;
    const [rotation, setRotation] = useState<number>(DEFAULT_ROTATION);

    const handleClick = useCallback(() => {
        const rot = rotation || 0;
        setTheme(theme === 'dark' ? 'light' : 'dark');
        setRotation(rot + 180);
    }, [theme, setTheme, setRotation, rotation]);

    useEffect(() => {
        if (rotation === DEFAULT_ROTATION) {
            // set initial rotation
            setRotation(theme === 'dark' ? 0 : 180);
        }
    }, [theme, setRotation, rotation]);

    return (
        <div
            onClick={handleClick}
            className="absolute -top-[72px] left-1/2 -ml-[60px] scale-75 rounded-full shadow-md transition-all hover:-top-[64px] hover:scale-100 hover:shadow-lg"
        >
            <svg
                width="120"
                height="120"
                viewBox="0 0 120 120"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                className="text-gray-400  transition-all hover:text-gray-500 dark:text-gray-400 hover:dark:text-gray-200"
                style={{
                    transform: `rotate(${rotation}deg)`,
                    opacity: rotation === undefined ? 0 : 1,
                    transition: 'opacity 100ms ease-out, transform 500ms ease-in-out',
                }}
            >
                <circle cx="60" cy="60" r="60" className="fill-gray-100 dark:fill-gray-900" />
                <circle cx="60" cy="60" r="10" fill="currentColor" opacity="0.5" />
                <path
                    fillRule="evenodd"
                    clipRule="evenodd"
                    d="M60.1869 84.36C60.3999 84.6157 60.4717 84.9605 60.3786 85.28C60.1324 86.1242 60 87.0182 60 87.9447C60 93.1914 64.2533 97.4447 69.5 97.4447C69.8311 97.4447 70.1579 97.4278 70.4797 97.3949C70.8107 97.361 71.1369 97.494 71.3498 97.7497C71.5628 98.0054 71.6346 98.3502 71.5415 98.6697C70.1474 103.45 65.7331 106.945 60.5 106.945C54.1487 106.945 49 101.796 49 95.445C49 89.493 53.5209 84.5982 59.3167 84.0052C59.6478 83.9713 59.9739 84.1043 60.1869 84.36ZM58.125 86.2441C54.0279 87.2984 51 91.0186 51 95.445C51 100.692 55.2533 104.945 60.5 104.945C64.3192 104.945 67.6139 102.691 69.1226 99.4387C62.946 99.2395 58 94.1697 58 87.9447C58 87.3673 58.0426 86.7994 58.125 86.2441Z"
                    fill="currentColor"
                />
                <path
                    fillRule="evenodd"
                    clipRule="evenodd"
                    d="M60 11.75L59.9925 11.75C59.3022 11.7504 58.7429 12.3103 58.7432 13.0007C58.7436 13.691 59.3036 14.2504 59.9939 14.25L60 14.25L60.0061 14.25C60.6964 14.2504 61.2564 13.691 61.2568 13.0007C61.2571 12.3103 60.6978 11.7504 60.0075 11.75L60 11.75ZM52.4029 17.3943C52.8913 16.9065 52.8917 16.115 52.4038 15.6266C51.916 15.1381 51.1245 15.1377 50.6361 15.6256L50.6256 15.6361C50.1377 16.1245 50.1381 16.916 50.6266 17.4038C51.115 17.8917 51.9065 17.8913 52.3943 17.4029L52.4029 17.3943ZM69.3639 15.6256C68.8755 15.1377 68.084 15.1381 67.5962 15.6266C67.1083 16.115 67.1087 16.9065 67.5971 17.3943L67.6057 17.4029C68.0935 17.8913 68.885 17.8917 69.3734 17.4038C69.8619 16.916 69.8623 16.1245 69.3744 15.6361L69.3639 15.6256ZM49.25 24.9939C49.2504 24.3036 48.691 23.7436 48.0007 23.7432C47.3103 23.7429 46.7504 24.3022 46.75 24.9925L46.75 25L46.75 25.0075C46.7504 25.6978 47.3103 26.2571 48.0007 26.2568C48.691 26.2564 49.2504 25.6964 49.25 25.0061L49.25 25L49.25 24.9939ZM73.25 24.9925C73.2496 24.3022 72.6897 23.7429 71.9993 23.7432C71.309 23.7436 70.7496 24.3036 70.75 24.9939L70.75 25L70.75 25.0061C70.7496 25.6964 71.309 26.2564 71.9993 26.2568C72.6897 26.2571 73.2496 25.6978 73.25 25.0075L73.25 25L73.25 24.9925ZM52.3943 32.5971C51.9065 32.1087 51.115 32.1083 50.6266 32.5962C50.1381 33.084 50.1377 33.8755 50.6256 34.3639L50.6361 34.3744C51.1245 34.8623 51.916 34.8619 52.4038 34.3734C52.8917 33.885 52.8913 33.0935 52.4029 32.6057L52.3943 32.5971ZM69.3744 34.3639C69.8623 33.8755 69.8619 33.084 69.3734 32.5962C68.885 32.1083 68.0935 32.1087 67.6057 32.5971L67.5971 32.6057C67.1087 33.0935 67.1083 33.885 67.5962 34.3734C68.084 34.8619 68.8755 34.8623 69.3639 34.3744L69.3744 34.3639ZM59.9939 35.75C59.3036 35.7496 58.7436 36.309 58.7432 36.9993C58.7429 37.6897 59.3022 38.2496 59.9925 38.25L60 38.25L60.0075 38.25C60.6978 38.2496 61.2571 37.6897 61.2568 36.9993C61.2564 36.309 60.6964 35.7496 60.0061 35.75L60 35.75L59.9939 35.75ZM53.5 25C53.5 21.4101 56.4101 18.5 60 18.5C63.5899 18.5 66.5 21.4101 66.5 25C66.5 28.5899 63.5899 31.5 60 31.5C56.4101 31.5 53.5 28.5899 53.5 25ZM60 16.5C55.3056 16.5 51.5 20.3056 51.5 25C51.5 29.6944 55.3056 33.5 60 33.5C64.6944 33.5 68.5 29.6944 68.5 25C68.5 20.3056 64.6944 16.5 60 16.5Z"
                    fill="currentColor"
                />
            </svg>
        </div>
    );
}
